<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Login</title>
        <link href="css/admin.css" rel="stylesheet" type="text/css">
    </head>
    <body>
        <div class="wrapp">
            <div class="cabecera">
                <img src="images/erp2.jpg"> 
                <div class="bienvenida">
                    <h1 id="bienvenida">Bienvenido administrador, <span id="usuarioCorreo"></span></h1>
                    <div class="menu">
                        <li>Inicio</li>
                        <li>Contacto</li>
                    </div> 
                </div>         
            </div>
            <div class="apartadoFormu">
                <button>Agregar</button>

                <div class="conrnidousuario">
                    <div class="claseInfo">
                        <li>Id</li>
                        <li>Nombre</li>
                        <li>Apellidos</li>
                        <li>Email</li>
                        <li>Telefono</li>
                        <li>Direccion</li>
                        <li>Opciones</li>
                    </div>     

                    <div class="usuarioGson">
                        <!-- Los datos de cada empleado se cargarán aquí dinámicamente -->
                    </div>
                </div>
            </div>
        </div>

        <script>
            function obtenerParametroURL(nombre) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(nombre);
            }

            const correo = obtenerParametroURL('correo');

            if (correo) {
                document.getElementById('usuarioCorreo').textContent = correo;
            } else {
                window.location.href = 'admin.html'; // Si no hay correo, redirige
            }

            // Función para obtener los empleados desde la API
            fetch('http://localhost:3000/empleados')
            .then(response => response.json())  // Parseamos la respuesta como JSON
            .then(data => {
                const usuarioGson = document.querySelector('.usuarioGson');
                usuarioGson.innerHTML = '';  // Limpiar cualquier contenido previo

                if (data.empleados && Array.isArray(data.empleados)) {
                    // Recorremos la lista de empleados
                    data.empleados.forEach(employee => {
                        const employeeDetails = document.createElement('div');
                        employeeDetails.classList.add('employeeDetails');  // Clase para cada empleado

                        // Crear un bloque de HTML con los datos del empleado
                        employeeDetails.innerHTML = `
                            <div class="employeeField">${employee.id}</div>
                            <div class="employeeField">${employee.nombre}</div>
                            <div class="employeeField">${employee.apellidos}</div>
                            <div class="employeeField">${employee.email}</div>
                            <div class="employeeField">${employee["número de teléfono"]}</div>
                            <div class="employeeField">${employee.dirección}</div>
                        `;

                        // Crear los botones de acción (editar y eliminar)
                        const editButton = document.createElement('button');
                        editButton.textContent = 'Editar';
                        editButton.onclick = () => editarEmpleado(employee.id);

                        const deleteButton = document.createElement('button');
                        deleteButton.textContent = 'Eliminar';
                        deleteButton.onclick = () => eliminarEmpleado(employee.id);

                        // Añadir los botones al div del empleado
                        employeeDetails.appendChild(editButton);
                        employeeDetails.appendChild(deleteButton);

                        // Añadir los detalles del empleado al contenedor
                        usuarioGson.appendChild(employeeDetails);
                    });
                } else {
                    usuarioGson.innerHTML = 'No se encontraron empleados.';
                }
            })
            .catch(error => {
                console.error('Error fetching employees:', error);
                document.querySelector('.usuarioGson').innerHTML = 'Error al cargar los empleados.';
            });

            // Función para eliminar un empleado
            function eliminarEmpleado(id) {
                fetch(`http://localhost:3000/empleados/${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.text())
                .then(message => {
                    console.log(message);
                    location.reload();  // Recargar la página después de eliminar
                })
                .catch(error => console.error('Error deleting employee:', error));
            }

            // Función de editar empleado (puedes mostrar un modal aquí)
            function editarEmpleado(id) {
                alert(`Editar empleado con ID: ${id}`);
                // Aquí puedes agregar la lógica para mostrar un modal con el formulario de edición
            }
        </script>
    </body>
</html>
