<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Login</title>
        <link href="css/admin.css" rel="stylesheet" type="text/css">
    </head>
    <body>
        <div class="wrapp">
            <div class="cabecera">
                <img src="images/erp2.jpg"> 
                <div class="bienvenida">
                    <h1 id="bienvenida">Bienvenido administrador, <span id="usuarioCorreo"></span></h1>
                    <div class="menu">
                        <li>Inicio</li>
                        <li>Contacto</li>
                    </div> 
                </div>         
            </div>
            <div class="apartadoFormu">
                <button>Agregar</button>

                <div class="conrnidousuario">
                    <div class="usuarioGson">
                        <!-- Los datos de cada empleado se cargarán aquí dinámicament e -->
                    </div>
                </div>
            </div>
        </div>

        <script>
            function obtenerParametroURL(nombre) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(nombre);
            }

            const correo = obtenerParametroURL('correo');

            if (correo) {
                document.getElementById('usuarioCorreo').textContent = correo;
            } else {
                window.location.href = 'admin.html'; // Si no hay correo, redirige
            }

            // Función para obtener los empleados desde la API
            fetch('http://localhost:3000/empleados')
            .then(response => response.json())  // Parseamos la respuesta como JSON
            .then(data => {
                const usuarioGson = document.querySelector('.usuarioGson'); // Obtener el contenedor donde se van a cargar los empleados

                // Limpiar el contenido de usuarioGson por si ya había contenido previo
                usuarioGson.innerHTML = '';

                data.empleados.forEach(employee => {
                    // Crear un div contenedor para los datos del empleado
                    const employeeDetails = document.createElement('div');
                    employeeDetails.classList.add('employeeDetails'); // Se puede usar esta clase para estilizar el contenedor

                    // Crear un bloque de datos con separación entre cada campo
                    employeeDetails.innerHTML = `
                        <div class="employeeField"> ${employee.id}</div>
                        <div class="employeeField"> ${employee.nombre}</div>
                        <div class="employeeField"><strong>Apellido:</strong> ${employee.apellidos}</div>
                        <div class="employeeField"><strong>Email:</strong> ${employee.email}</div>
                        <div class="employeeField"><strong>Teléfono:</strong> ${employee["número de teléfono"]}</div>
                        <div class="employeeField"><strong>Dirección:</strong> ${employee.dirección}</div>
                    `;

                    // Crear el botón de eliminar
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Eliminar';
                    deleteButton.onclick = () => eliminarEmpleado(employee.id);

                    // Añadir el botón al div del empleado
                    employeeDetails.appendChild(deleteButton);

                    // Añadir el div con los detalles del empleado al contenedor .usuarioGson
                    usuarioGson.appendChild(employeeDetails);
                });
            })
            .catch(error => console.error('Error fetching employees:', error));

            function eliminarEmpleado(id) {
                fetch(`http://localhost:3000/empleados/${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.text())
                .then(message => {
                    console.log(message);
                    // Recargar la lista o actualizar la UI como se necesite
                    location.reload(); // Método sencillo de refrescar la lista
                })
                .catch(error => console.error('Error deleting employee:', error));
            }
        </script>
    </body>
</html>
